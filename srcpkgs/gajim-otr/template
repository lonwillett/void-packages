# Template file for 'gajim-otr'
pkgname=gajim-otr
version=1.9.8
revision=3
noarch=yes
wrksrc="gotr"
pycompile_dirs="usr/share/gajim/plugins/gotr"
hostmakedepends="wget unzip"
depends="python-crypto"
short_desc="OTR Plugin for Gajim"
homepage="https://dev.gajim.org/gajim/gajim-plugins/wikis/OffTheRecordPlugin"
maintainer="Helmut Pozimski <helmut@pozimski.eu>"
license="GPL-3"
#distfiles="https://ftp.gajim.org/plugins_0.16_zip/gotr.zip"
#checksum=9bb82465c6faae335491310896a8cda99c7ffed91e90b0283ea98f4aa13e2fa1
checksum=0914a969ce930e85718eea7de6b229165d249d5bf869731bc6f14274862976ca

do_fetch() {
	# Source archives seem to be regenerated frequently, with
	# indeterminate file order or some other such innocuous
	# changes.
	plug="gotr"
	$XBPS_FETCH_CMD "https://ftp.gajim.org/plugins_0.16_zip/$plug.zip"
	mkdir "$plug.tmp"
	unzip -o -q "$plug.zip" -d "$plug.tmp"
	. $FILESDIR/checksum-dir.sh
	x="$(checksum_dir "$plug.tmp")"
	if [ -e "$wrksrc" ]; then rm -rf "$wrksrc"; fi
	mv "$plug.tmp/$plug" "$wrksrc"
	rm -rf "$plug.zip" "$plug.tmp"
	if [ "$checksum" != "$x" ]; then
		echo "$x"
		return 1
	fi
}

do_install() {
	vmkdir usr/share/gajim/plugins/gotr
	vcopy * usr/share/gajim/plugins/gotr
}
