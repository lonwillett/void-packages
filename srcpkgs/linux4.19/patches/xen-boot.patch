From https://lists.xenproject.org/archives/html/xen-devel/2018-11/msg03410.html

diff --git a/arch/x86/mm/dump_pagetables.c b/arch/x86/mm/dump_pagetables.c
index a12afff146d1..8c04fadc4423 100644
--- a/arch/x86/mm/dump_pagetables.c
+++ b/arch/x86/mm/dump_pagetables.c
@@ -496,8 +496,8 @@ static inline bool is_hypervisor_range(int idx)
         * ffff800000000000 - ffff87ffffffffff is reserved for
         * the hypervisor.
         */
-       return  (idx >= pgd_index(__PAGE_OFFSET) - 16) &&
-               (idx <  pgd_index(__PAGE_OFFSET));
+       return  (idx >= pgd_index(LDT_BASE_ADDR) - 16) &&
+               (idx <  pgd_index(LDT_BASE_ADDR));
 #else
        return false;
 #endif
diff --git a/arch/x86/xen/mmu_pv.c b/arch/x86/xen/mmu_pv.c
index 2c84c6ad8b50..b078a5b0ac91 100644
--- a/arch/x86/xen/mmu_pv.c
+++ b/arch/x86/xen/mmu_pv.c
@@ -652,7 +652,7 @@ static int __xen_pgd_walk(struct mm_struct *mm, pgd_t *pgd,
         * will end up making a zero-sized hole and so is a no-op.
         */
        hole_low = pgd_index(USER_LIMIT);
-       hole_high = pgd_index(PAGE_OFFSET);
+       hole_high = pgd_index(LDT_BASE_ADDR);
 
        nr = pgd_index(limit) + 1;
        for (i = 0; i < nr; i++) {
