# Template file for 'ookla-speedtest-cli'
pkgname=ookla-speedtest-cli
version=1.0.0.2
revision=1
wrksrc="${pkgname}-${version}"
build_style="fetch"

short_desc="Ookla's bandwidth test tool using speedtest.net"
maintainer="Lon Willett <xgit@lonw.net>"
homepage="https://www.speedtest.net/apps/cli"
license="Proprietary"
repository="nonfree"
archs="x86_64 x86_64-musl i686 i686-musl aarch64 aarch64-musl armv7l armv7l-musl armv6l armv6l-musl"
hostmakedepends="wget tar"
nostrip="yes"

case "${XBPS_TARGET_MACHINE}" in
	x86_64*)
		_arch="x86_64"
		checksum=5fe2028f0d4427e4f4231d9f9cf70e6691bb890a70636d75232fe4d970633168
		;;
	i686*)
		_arch="i386"
		checksum=828362e559e53d80b3579df032fe756a0993cf33934416fa72e9d69c8025321b
		;;
	aarch64*)
		_arch="aarch64"
		checksum=073684dc3490508ca01b04c5855e04cfd797fed33f6ea6a6edc26dfbc6f6aa9e
		;;
	armv7l*)
		_arch="armhf"
		checksum=04b54991cfb9492ea8b2a3500340e7eeb78065a00ad25a032be7763f1415decb
		;;
	armv6l*)
		_arch="arm"
		checksum=0fa7b3237d0fe4fa15bc1e7cb27ccac63b02a2679b71c2879d59dd75d3c9235d
		;;
esac

_filename="ookla-speedtest-${version%.*}-${_arch}-linux.tgz"
distfiles="https://bintray.com/ookla/download/download_file?file_path=${_filename}"

do_fetch() {
	mkdir -p $wrksrc
	cd $wrksrc
	wget -O "$_filename" $distfiles
	echo "$checksum  $_filename" | sha256sum -c || { sha256sum "$_filename"; return 1; }
}

do_extract() {
	tar xzf $_filename
}

do_install() {
	vbin speedtest ookla-speedtest
	vman speedtest.5 ookla-speedtest.5
	#vinstall speedtest.md
}
