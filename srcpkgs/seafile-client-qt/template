# Template file for 'seafile-client-qt'
pkgname=seafile-client-qt
version=8.0.4
#yyy_gitrev=7317fb425226961708c6dccf5c0607ba2a177797
revision=1
_sourcename="seafile-client"
wrksrc="${_sourcename}-${version}"
#yyywrksrc="${_sourcename}-${_gitrev}"
build_style=cmake
configure_args="$(vopt_if shibboleth '-DBUILD_SHIBBOLETH_SUPPORT=ON -DUSE_QT_WEBKIT=ON')"
hostmakedepends="pkg-config"
makedepends="qt5-tools-devel seafile-libclient-devel sqlite-devel libevent-devel
 $(vopt_if shibboleth 'qt5-webkit-devel')"
short_desc="Cloud storage system - Qt graphical client"
maintainer="yopito <pierre.bourgin@free.fr>"
license="Apache-2.0"
homepage="https://seafile.com"
distfiles="https://github.com/haiwen/seafile-client/archive/v${version}.tar.gz"
checksum=36cf8bab06aad9680dc043111941c72f9a681ac3828aa7a07ea4f32a829e2159
#yyydistfiles="https://github.com/haiwen/seafile-client/archive/${_gitrev}.tar.gz"
#yyychecksum=61cb84feefcc02175921cab5d3f8e04b588fd4a8278d772f59c0577de0c553f2

build_options="shibboleth"
desc_option_shibboleth="Build with Shibboleth support"
build_options_default="shibboleth"

case "$XBPS_TARGET_MACHINE" in
	*-musl)	# need fts implementation
		makedepends+=" musl-fts-devel" ;;
esac

if [ "$CROSS_BUILD" ]; then
	hostmakedepends+=" qt5-qmake qt5-host-tools qt5-tools"
fi

pre_configure() {
	case "$XBPS_TARGET_MACHINE" in
		*-musl)
			# append '-ltfs' argument on link via cmake (macro TARGET_LINK_LIBRARIES)
			# "LDFLAGS=-lfts" does not work, its prepends it (useless)
			# XXX prefer patch on CMakeLists.txt ?
			sed -i -e 's,\(\${EXTRA_LIBS}\)$,\1 -lfts,' ${wrksrc}/CMakeLists.txt
			;;
	esac
}

post_install() {
	vdoc README.md
}
