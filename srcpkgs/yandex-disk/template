# Template file for 'yandex-disk'
pkgname=yandex-disk
version=0.1.5.1010
revision=1
only_for_archs="i686 x86_64"
short_desc="Console client for Yandex.Disk"
build_style="fetch"
nostrip="yes"
maintainer="Alexander Mamay <alexander@mamay.su>"
license="Proprietary"
homepage="https://disk.yandex.com/"
repository="nonfree"
restricted=yes
nostrip_files=yandex-disk

if [ "$XBPS_TARGET_MACHINE" = "x86_64" ]; then
	debpkgid="${pkgname}_${version}_amd64.deb"
	distfiles="https://repo.yandex.ru/yandex-disk/deb/pool/main/${pkgname:0:1}/${pkgname}/${debpkgid}"
	checksum=901756adb89ee46dab4838795bd62c74ee272e64946bb1670dd0b7b246fae3cc
else
	debpkgid="${pkgname}_${version}_i386.deb"
	distfiles="https://repo.yandex.ru/yandex-disk/deb/pool/main/${pkgname:0:1}/${pkgname}/${debpkgid}"
	checksum=685f6f62a637ae0ffa5a93382024d2fd95853096d7e91c49bb3d280c2980eb7b
fi

do_extract() {
	ar p ${XBPS_SRCDISTDIR}/${pkgname}-${version}/${debpkgid} data.tar.gz | tar xzpf - ./usr ./etc
	gunzip usr/share/doc/${pkgname}/changelog.gz
	find usr/share/man -type f -name '*.gz' -print0 | xargs -0 gunzip
}

do_install() {
	vbin usr/bin/yandex-disk
	vlicense usr/share/doc/yandex-disk/copyright
	vman usr/share/man/man1/yandex-disk.1
	vcopy usr/share/locale usr/share
	install -m644 -D etc/bash_completion.d/yandex-disk-completion.bash \
		${DESTDIR}/usr/share/bash-completion/completions/yandex-disk
	sed -e "s/^\(have.*\)/\#\1/" -i ${DESTDIR}/usr/share/bash-completion/completions/yandex-disk
}
